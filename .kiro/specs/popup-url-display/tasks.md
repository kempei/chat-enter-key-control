# 実装計画

- [x] 1. HTML構造の拡張
  - popup.htmlの`.current-url`要素に`.url-text`と`.url-expand-indicator`を追加
  - data-full-url属性を追加してURLを保存
  - _要件: 1.1, 1.2, 3.1, 3.2_

- [x] 2. URL省略ロジックの実装
  - displayURL()関数を実装
  - 100文字を境界としてURL省略判定
  - 省略記号（...）の追加
  - data-full-url属性への完全URL保存
  - _要件: 1.1, 1.2, 1.4_

- [x] 2.1 短いURLの全体表示プロパティテストを実装
  - **プロパティ 1: 短いURLは全体表示される**
  - **検証対象: 要件 1.1**

- [x] 2.2 長いURLの省略プロパティテストを実装
  - **プロパティ 2: 長いURLは省略される**
  - **検証対象: 要件 1.2**

- [x] 2.3 長いURLのデフォルト状態プロパティテストを実装
  - **プロパティ 4: 長いURLはデフォルトで省略される**
  - **検証対象: 要件 1.4**

- [x] 3. トグル機能の実装
  - toggleURLDisplay()関数を実装
  - 省略状態と展開状態の切り替え
  - インジケーターアイコンの変更（▼ ⇔ ▲）
  - _要件: 2.1, 2.2_

- [x] 3.1 省略状態のクリックで展開プロパティテストを実装
  - **プロパティ 6: 省略状態のクリックで展開される**
  - **検証対象: 要件 2.1**

- [x] 3.2 展開状態のクリックで折りたたみプロパティテストを実装
  - **プロパティ 7: 展開状態のクリックで折りたたまれる**
  - **検証対象: 要件 2.2**

- [x] 4. 状態管理の実装
  - URLDisplayState型の定義
  - 状態の初期化とリセット処理
  - URL変更時の状態リセット
  - _要件: 1.5_

- [x] 4.1 URL変更時の状態リセットプロパティテストを実装
  - **プロパティ 5: URL変更時に状態がリセットされる**
  - **検証対象: 要件 1.5**

- [x] 5. イベントリスナーの追加
  - .current-url要素のclickイベントリスナーを実装
  - クリック可能な状態の判定
  - toggleURLDisplay()の呼び出し
  - _要件: 2.1, 2.2_

- [x] 6. CSSスタイルの実装
  - .current-url.clickableクラスのスタイル
  - .current-url.truncatedクラスのスタイル
  - .current-url.expandedクラスのスタイル
  - .url-expand-indicatorのスタイル
  - トランジションアニメーション
  - ホバー時のスタイル
  - _要件: 2.3, 2.4, 3.4_

- [x] 6.1 クリック可能な要素のカーソルプロパティテストを実装
  - **プロパティ 8: クリック可能な要素はポインターカーソルを表示**
  - **検証対象: 要件 2.3**

- [x] 6.2 ホバー時の視覚的フィードバックプロパティテストを実装
  - **プロパティ 11: ホバー時に視覚的フィードバックを提供**
  - **検証対象: 要件 3.4**

- [x] 7. インジケーター表示制御の実装
  - 省略状態のインジケーター表示（▼）
  - 展開状態のインジケーター表示（▲）
  - 短いURLでのインジケーター非表示
  - _要件: 1.3, 3.1, 3.2, 3.3_

- [x] 7.1 省略状態の視覚的インジケータープロパティテストを実装
  - **プロパティ 3: 省略状態は視覚的に示される**
  - **検証対象: 要件 1.3, 3.1**

- [x] 7.2 展開状態の視覚的インジケータープロパティテストを実装
  - **プロパティ 9: 展開状態は視覚的に示される**
  - **検証対象: 要件 3.2**

- [x] 7.3 短いURLのインジケーター非表示プロパティテストを実装
  - **プロパティ 10: 短いURLはインジケーターを表示しない**
  - **検証対象: 要件 3.3**

- [x] 8. 既存コードへの統合
  - popup.jsのupdateCurrentPageStatus()関数にdisplayURL()を統合
  - 初期化処理にイベントリスナーを追加
  - URL変更時の状態リセット処理を追加
  - _要件: すべて_

- [x] 9. エラーハンドリングの実装
  - URLが取得できない場合のエラーメッセージ
  - 空のURLの処理
  - DOM要素が見つからない場合のエラーハンドリング
  - _要件: すべて_

- [x] 10. チェックポイント - すべてのテストが通ることを確認
  - すべてのテストが通ることを確認し、問題があればユーザーに質問する

- [x] 11. 実際のChrome拡張機能での統合テスト
  - 様々な長さのURLを持つサイトで動作確認
  - 展開/折りたたみの動作確認
  - トランジションアニメーションの確認
  - インジケーターの視認性確認
  - _要件: すべて_

- [x] 12. アクセシビリティの実装
  - Enterキーでのトグル機能
  - aria-expanded属性の追加
  - フォーカス時のスタイル
  - _要件: 2.1, 2.2, 3.4_

- [x] 13. ドキュメントの更新
  - README.mdにURL表示機能の説明を追加
  - 使用方法のスクリーンショットを追加（オプション）
  - _要件: すべて_

