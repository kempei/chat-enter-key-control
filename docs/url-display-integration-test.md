# URL表示機能 統合テストガイド

このドキュメントは、URL表示機能の統合テストを実施するための手順書です。

## 自動E2Eテスト

Playwrightを使用した自動E2Eテストが実装されています。以下のコマンドで実行できます：

```bash
npm run test:e2e -- test/e2e/url-display.e2e.test.js
```

このテストは、実際のChrome拡張機能環境をシミュレートし、以下の項目を自動的に検証します：

- 短いURL（100文字以下）の全体表示
- 長いURL（100文字超）の省略表示
- 展開/折りたたみの動作
- 境界値テスト（100文字、101文字）
- 非常に長いURL（500文字）の動作
- ホバー時のカーソル表示
- トランジションアニメーション
- URL変更時の状態リセット
- 空のURLのエラーハンドリング

## 手動テスト環境の準備

### 1. Chrome拡張機能のインストール

1. Chromeブラウザを開く
2. `chrome://extensions/` にアクセス
3. 右上の「デベロッパーモード」を有効化
4. 「パッケージ化されていない拡張機能を読み込む」をクリック
5. プロジェクトのルートディレクトリを選択

### 2. テスト用URLの準備

以下のURLを使用してテストを実施します：

- **短いURL（100文字以下）**: `https://example.com/`
- **長いURL（120文字）**: `https://example.com/` + 'a' を100回繰り返し
- **境界値URL（100文字ちょうど）**: `https://example.com/` + 'f' を81回繰り返し
- **境界値URL（101文字）**: `https://example.com/` + 'g' を82回繰り返し
- **非常に長いURL（500文字）**: `https://example.com/` + 'h' を481回繰り返し

## テストケース

### テスト1: 短いURL（100文字以下）の表示確認

**目的**: 短いURLが全体表示され、インジケーターが表示されないことを確認

**手順**:
1. `https://example.com/` にアクセス
2. 拡張機能のアイコンをクリックしてポップアップを開く
3. URL表示領域を確認

**期待される結果**:
- ✅ URLが全体表示される（省略記号なし）
- ✅ 展開インジケーター（▼）が表示されない
- ✅ URL表示領域にカーソルを合わせてもポインターカーソルにならない
- ✅ `clickable` クラスが付与されていない

**検証方法**:
- 開発者ツールで `#currentUrl` 要素を確認
- `.url-expand-indicator` の `display` プロパティが `none` であることを確認
- `.clickable` クラスが存在しないことを確認

---

### テスト2: 長いURL（100文字超）の省略表示確認

**目的**: 長いURLが省略表示され、インジケーターが表示されることを確認

**手順**:
1. 長いURL（120文字）にアクセス
   - 例: `https://example.com/aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa`
2. 拡張機能のアイコンをクリックしてポップアップを開く
3. URL表示領域を確認

**期待される結果**:
- ✅ 最初の100文字 + "..." が表示される
- ✅ 展開インジケーター（▼）が表示される
- ✅ URL表示領域にカーソルを合わせるとポインターカーソルになる
- ✅ `clickable` と `truncated` クラスが付与されている

**検証方法**:
- 開発者ツールで `.url-text` の内容を確認
- `.url-expand-indicator` が表示されていることを確認
- `cursor: pointer` が適用されていることを確認

---

### テスト3: 長いURLの展開/折りたたみ動作確認

**目的**: クリックによる展開/折りたたみが正しく動作することを確認

**手順**:
1. 長いURL（150文字）にアクセス
2. 拡張機能のアイコンをクリックしてポップアップを開く
3. URL表示領域をクリック（展開）
4. もう一度URL表示領域をクリック（折りたたみ）

**期待される結果**:

**初期状態（省略）**:
- ✅ 最初の100文字 + "..." が表示される
- ✅ インジケーターが "▼" になっている
- ✅ `truncated` クラスが付与されている

**展開後**:
- ✅ 完全なURLが表示される
- ✅ インジケーターが "▲" になっている
- ✅ `expanded` クラスが付与されている
- ✅ `truncated` クラスが削除されている

**折りたたみ後**:
- ✅ 最初の100文字 + "..." が表示される
- ✅ インジケーターが "▼" に戻っている
- ✅ `truncated` クラスが付与されている
- ✅ `expanded` クラスが削除されている

**検証方法**:
- 各状態で開発者ツールでクラスとテキスト内容を確認
- インジケーターの文字が変化することを確認

---

### テスト4: ホバー時の視覚的フィードバック確認

**目的**: ホバー時に視覚的フィードバックが提供されることを確認

**手順**:
1. 長いURLにアクセス
2. 拡張機能のアイコンをクリックしてポップアップを開く
3. URL表示領域にマウスカーソルを合わせる

**期待される結果**:
- ✅ 背景色が変化する（`#f1f3f4` になる）
- ✅ テキスト色が変化する（`#202124` になる）
- ✅ カーソルが `pointer` になる
- ✅ 滑らかなトランジションアニメーションが適用される

**検証方法**:
- 開発者ツールで `:hover` 状態のスタイルを確認
- `background-color` と `color` の変化を確認
- `transition` プロパティが設定されていることを確認

---

### テスト5: URL変更時の状態リセット確認

**目的**: URL変更時に展開状態がリセットされることを確認

**手順**:
1. 長いURL（例: URL1）にアクセス
2. 拡張機能のアイコンをクリックしてポップアップを開く
3. URL表示領域をクリックして展開
4. 別の長いURL（例: URL2）にアクセス
5. ポップアップを閉じて再度開く

**期待される結果**:
- ✅ URL1を展開した状態から、URL2に変更すると省略状態にリセットされる
- ✅ インジケーターが "▼" になっている
- ✅ `truncated` クラスが付与されている
- ✅ `expanded` クラスが削除されている

**検証方法**:
- URL変更後のポップアップで状態を確認
- 開発者ツールでクラスを確認

---

### テスト6: 境界値テスト - ちょうど100文字のURL

**目的**: 100文字ちょうどのURLが全体表示されることを確認

**手順**:
1. 100文字ちょうどのURLにアクセス
   - 例: `https://example.com/` + 'f' を81回繰り返し（合計100文字）
2. 拡張機能のアイコンをクリックしてポップアップを開く

**期待される結果**:
- ✅ URLが全体表示される（省略記号なし）
- ✅ インジケーターが表示されない
- ✅ `clickable` クラスが付与されていない

**検証方法**:
- URLの長さを確認（開発者ツールで `.url-text` の `textContent.length` を確認）
- インジケーターが非表示であることを確認

---

### テスト7: 境界値テスト - 101文字のURL

**目的**: 101文字のURLが省略表示されることを確認

**手順**:
1. 101文字のURLにアクセス
   - 例: `https://example.com/` + 'g' を82回繰り返し（合計101文字）
2. 拡張機能のアイコンをクリックしてポップアップを開く

**期待される結果**:
- ✅ 最初の100文字 + "..." が表示される
- ✅ インジケーターが表示される
- ✅ `clickable` クラスが付与されている

**検証方法**:
- 表示されているテキストの長さを確認（103文字: 100文字 + "..."）
- インジケーターが表示されていることを確認

---

### テスト8: 非常に長いURL（500文字）の表示確認

**目的**: 非常に長いURLでも正しく動作することを確認

**手順**:
1. 500文字のURLにアクセス
2. 拡張機能のアイコンをクリックしてポップアップを開く
3. URL表示領域をクリックして展開

**期待される結果**:

**省略状態**:
- ✅ 最初の100文字 + "..." が表示される

**展開状態**:
- ✅ 完全な500文字のURLが表示される
- ✅ テキストが折り返されて表示される
- ✅ ポップアップのレイアウトが崩れない

**検証方法**:
- 展開後のテキストの長さを確認（500文字）
- ポップアップのスクロールやレイアウトを確認

---

### テスト9: トランジションアニメーションの確認

**目的**: 展開/折りたたみ時に滑らかなアニメーションが適用されることを確認

**手順**:
1. 長いURLにアクセス
2. 拡張機能のアイコンをクリックしてポップアップを開く
3. URL表示領域をクリックして展開
4. アニメーションを観察

**期待される結果**:
- ✅ テキストの変化が滑らかに行われる（0.3秒のトランジション）
- ✅ インジケーターの変化が滑らかに行われる（0.2秒のトランジション）
- ✅ 背景色の変化が滑らかに行われる（0.2秒のトランジション）

**検証方法**:
- 開発者ツールで `.url-text` の `transition` プロパティを確認
- 実際にクリックしてアニメーションを観察

---

### テスト10: 複数のタブでの独立性確認

**目的**: 複数のタブで独立してURL表示が動作することを確認

**手順**:
1. タブ1で短いURL（`https://example.com/short`）を開く
2. タブ2で長いURLを開く
3. タブ2をアクティブにして拡張機能のポップアップを開く
4. タブ1をアクティブにして拡張機能のポップアップを開く

**期待される結果**:
- ✅ タブ2のポップアップでは長いURLが省略表示される
- ✅ タブ1のポップアップでは短いURLが全体表示される
- ✅ 各タブで独立してURL表示が動作する

**検証方法**:
- 各タブでポップアップを開いてURL表示を確認
- タブを切り替えてもURL表示が正しく更新されることを確認

---

## テスト結果の記録

各テストケースの結果を以下の表に記録してください：

| テストケース | 実施日 | 結果 | 備考 |
|------------|--------|------|------|
| テスト1: 短いURL | YYYY-MM-DD | ✅/❌ | |
| テスト2: 長いURL省略 | YYYY-MM-DD | ✅/❌ | |
| テスト3: 展開/折りたたみ | YYYY-MM-DD | ✅/❌ | |
| テスト4: ホバー | YYYY-MM-DD | ✅/❌ | |
| テスト5: 状態リセット | YYYY-MM-DD | ✅/❌ | |
| テスト6: 境界値100文字 | YYYY-MM-DD | ✅/❌ | |
| テスト7: 境界値101文字 | YYYY-MM-DD | ✅/❌ | |
| テスト8: 非常に長いURL | YYYY-MM-DD | ✅/❌ | |
| テスト9: アニメーション | YYYY-MM-DD | ✅/❌ | |
| テスト10: 複数タブ | YYYY-MM-DD | ✅/❌ | |

## トラブルシューティング

### 問題: URLが表示されない

**原因**: ポップアップの初期化が完了していない可能性があります。

**解決策**:
1. ポップアップを閉じて再度開く
2. 拡張機能をリロードする（`chrome://extensions/` で「再読み込み」をクリック）

### 問題: インジケーターが表示されない

**原因**: CSSが正しく読み込まれていない可能性があります。

**解決策**:
1. 開発者ツールで `.url-expand-indicator` の `display` プロパティを確認
2. `popup.css` が正しく読み込まれているか確認

### 問題: クリックしても展開されない

**原因**: イベントリスナーが正しく登録されていない可能性があります。

**解決策**:
1. 開発者ツールのコンソールでエラーを確認
2. `popup.js` が正しく読み込まれているか確認
3. `#currentUrl` 要素に `clickable` クラスが付与されているか確認

## まとめ

すべてのテストケースが成功した場合、URL表示機能は正しく実装されています。

問題が発生した場合は、以下を確認してください：
- 拡張機能が最新の状態で読み込まれているか
- `popup.js`、`popup.css`、`popup.html` が正しく配置されているか
- 開発者ツールのコンソールにエラーが表示されていないか
