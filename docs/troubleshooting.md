# トラブルシューティングガイド

このガイドでは、Chat Enter Key Control拡張機能の使用中に発生する可能性のある問題と、その解決方法を説明します。

## 目次

- [拡張機能が動作しない](#拡張機能が動作しない)
- [特定のサイトで動作しない](#特定のサイトで動作しない)
- [修飾キーで送信できない](#修飾キーで送信できない)
- [改行が挿入されない](#改行が挿入されない)
- [設定が保存されない](#設定が保存されない)
- [パフォーマンスの問題](#パフォーマンスの問題)
- [他の拡張機能との競合](#他の拡張機能との競合)
- [デバッグ方法](#デバッグ方法)

## 拡張機能が動作しない

### 症状

Enterキーを押してもメッセージが送信されてしまう（改行が挿入されない）

### 原因

- URLパターンが設定されていない
- URLパターンが無効になっている
- 拡張機能が正しくインストールされていない

### 解決方法

#### 1. 拡張機能アイコンを確認

ブラウザツールバーの拡張機能アイコンを確認します：

- **カラーアイコン**: 現在のページで有効
- **グレーアイコン**: 現在のページで無効

グレーの場合は、URLパターンを追加する必要があります。

#### 2. URLパターンを確認

1. 拡張機能アイコンをクリックしてポップアップを開く
2. 「登録済みパターン」セクションを確認
3. 現在のサイトのURLにマッチするパターンがあるか確認
4. パターンのトグルスイッチが「有効」になっているか確認

#### 3. URLパターンを追加

パターンが存在しない場合：

1. 「現在のドメインを追加」ボタンをクリック（簡単）
2. または、「URLパターンを追加」フィールドに手動でパターンを入力

例：
```
*://chat.openai.com/*
*://*.slack.com/*
*://discord.com/*
```

#### 4. ページをリロード

URLパターンを追加または変更した後は、ページをリロードしてください：

- `Ctrl+R` (Windows/Linux)
- `Cmd+R` (macOS)
- または、ブラウザのリロードボタンをクリック

#### 5. 拡張機能を再インストール

上記で解決しない場合は、拡張機能を再インストールしてください：

1. `chrome://extensions/` を開く
2. Chat Enter Key Controlの「削除」をクリック
3. 再度インストール手順に従ってインストール

## 特定のサイトで動作しない

### 症状

一部のサイトでのみ拡張機能が動作しない

### 原因

- URLパターンが正しくない
- サイトが特殊なフィールドを使用している
- サイトのJavaScriptが干渉している
- 他の拡張機能との競合

### 解決方法

#### 1. URLパターンを確認

URLパターンが正しいか確認します：

**よくある間違い**:

❌ `chat.openai.com` - スキームとパスが不足
✅ `*://chat.openai.com/*` - 正しい形式

❌ `*.slack.com/*` - スキームが不足
✅ `*://*.slack.com/*` - 正しい形式

#### 2. ワイルドカードの使用

サブドメインがある場合は、ワイルドカードを使用します：

```
*://*.example.com/*
```

これにより、以下のすべてにマッチします：
- `app.example.com`
- `chat.example.com`
- `workspace.example.com`

#### 3. ブラウザコンソールでエラーを確認

1. `F12`キーを押してデベロッパーツールを開く
2. 「Console」タブを選択
3. エラーメッセージがないか確認
4. エラーがある場合は、GitHubのIssuesで報告

#### 4. フィールドが動的に生成される場合

一部のサイトでは、フィールドが動的に生成されます。この場合：

1. ページが完全に読み込まれるまで待つ
2. フィールドをクリックしてフォーカスを当てる
3. 少し待ってから入力を開始

拡張機能はMutationObserverで動的フィールドを検出しますが、検出に最大500ミリ秒かかる場合があります。

#### 5. 他の拡張機能を無効化

他の拡張機能が干渉している可能性があります：

1. `chrome://extensions/` を開く
2. 他の拡張機能を一時的に無効化
3. 問題が解決するか確認
4. 競合する拡張機能を特定

## 修飾キーで送信できない

### 症状

Ctrl+EnterやCmd+Enterを押してもメッセージが送信されない

### 原因

- 対象サイトが修飾キーによる送信をサポートしていない
- サイトの設定で修飾キー送信が無効になっている
- 拡張機能が修飾キーイベントを正しく伝播していない

### 解決方法

#### 1. サイトの送信ボタンを使用

修飾キーで送信できない場合は、サイトの送信ボタンをクリックしてください。

拡張機能は送信ボタンのクリックを妨げません。

#### 2. サイトの設定を確認

一部のサイトでは、修飾キーによる送信を設定で有効にする必要があります：

- **Slack**: 設定 > 詳細設定 > Enterキーで送信
- **Discord**: 設定 > テキスト & 画像 > Enterキーで送信

#### 3. 一時的に拡張機能を無効化

修飾キーが必要ない場合は、一時的に拡張機能を無効化できます：

1. ポップアップを開く
2. 現在のパターンのトグルスイッチをOFFにする
3. 通常のEnterで送信

#### 4. 対応する修飾キーを確認

拡張機能は以下の修飾キーをサポートしています：

- **Windows/Linux**: Ctrl+Enter、Alt+Enter
- **macOS**: Cmd+Enter、Opt+Enter

## 改行が挿入されない

### 症状

Enterキーを押しても改行が挿入されない

### 原因

- テキストフィールドが正しく検出されていない
- サイトのJavaScriptが改行挿入を妨げている
- contenteditable要素で特殊な処理が必要

### 解決方法

#### 1. フィールドタイプを確認

ブラウザのデベロッパーツールで、フィールドのタイプを確認します：

1. `F12`キーを押してデベロッパーツールを開く
2. 「Elements」タブを選択
3. 要素選択ツール（左上の矢印アイコン）をクリック
4. テキストフィールドをクリック
5. HTML要素を確認

**対応している要素**:
- `<textarea>`
- `<input type="text">`
- `[contenteditable="true"]`
- `[contenteditable=""]`

#### 2. ブラウザコンソールでエラーを確認

1. `F12`キーを押してデベロッパーツールを開く
2. 「Console」タブを選択
3. Enterキーを押したときにエラーが表示されるか確認

#### 3. サイト固有の問題を報告

上記で解決しない場合は、GitHubのIssuesで報告してください：

- サイトのURL
- フィールドのHTML要素
- ブラウザコンソールのエラーメッセージ

## 設定が保存されない

### 症状

ブラウザを再起動すると設定が消える

### 原因

- Chrome Syncが無効になっている
- ストレージの容量制限に達している
- 拡張機能のインストールが破損している

### 解決方法

#### 1. Chrome Syncを確認

1. Chromeの設定を開く（`chrome://settings/`）
2. 「同期とGoogleサービス」を選択
3. 「同期」がオンになっているか確認

#### 2. ストレージ容量を確認

Chrome拡張機能のストレージには容量制限があります：

- chrome.storage.sync: 102,400バイト（約100KB）
- chrome.storage.local: 5,242,880バイト（約5MB）

多数のURLパターンを登録している場合は、不要なパターンを削除してください。

#### 3. 設定をエクスポート

設定が消える前に、エクスポートしてバックアップを作成します：

1. ポップアップを開く
2. 「設定をエクスポート」ボタンをクリック
3. JSONファイルを安全な場所に保存

#### 4. 拡張機能を再インストール

1. 設定をエクスポート（上記）
2. `chrome://extensions/` を開く
3. Chat Enter Key Controlの「削除」をクリック
4. 再度インストール
5. 設定をインポート

## パフォーマンスの問題

### 症状

ページの動作が遅くなる、入力に遅延がある

### 原因

- 多数のテキストフィールドが存在する
- 他の拡張機能との競合
- MutationObserverの負荷

### 解決方法

#### 1. 不要なURLパターンを削除

使用していないサイトのURLパターンを削除します：

1. ポップアップを開く
2. 不要なパターンの「削除」ボタンをクリック

#### 2. パターンを一時的に無効化

頻繁に使用しないサイトのパターンは、無効化しておきます：

1. ポップアップを開く
2. パターンのトグルスイッチをOFFにする

#### 3. リソース使用状況を確認

Chromeのタスクマネージャーでリソース使用状況を確認します：

1. `Shift+Esc`キーを押してタスクマネージャーを開く
2. 「拡張機能: Chat Enter Key Control」を探す
3. CPU使用率とメモリ使用量を確認

通常の使用では：
- CPU使用率: 1%未満
- メモリ使用量: 10MB未満

#### 4. 他の拡張機能を確認

他の拡張機能が原因の可能性があります：

1. `chrome://extensions/` を開く
2. 他の拡張機能を一時的に無効化
3. パフォーマンスが改善するか確認

## 他の拡張機能との競合

### 症状

他の拡張機能と同時に使用すると動作しない

### よくある競合

#### キーボードショートカット拡張機能

キーボードショートカットをカスタマイズする拡張機能と競合する可能性があります。

**解決方法**:
- 他の拡張機能でEnterキーのショートカットを無効化
- または、Chat Enter Key Controlを一時的に無効化

#### テキスト入力支援拡張機能

テキスト入力を支援する拡張機能（自動補完、スペルチェックなど）と競合する可能性があります。

**解決方法**:
- 両方の拡張機能を有効にして動作を確認
- 問題がある場合は、どちらかを無効化

#### チャットアプリ専用拡張機能

特定のチャットアプリ用の拡張機能と競合する可能性があります。

**解決方法**:
- 両方の拡張機能の設定を確認
- 重複する機能を無効化

## デバッグ方法

### ブラウザコンソールの使用

1. `F12`キーを押してデベロッパーツールを開く
2. 「Console」タブを選択
3. 拡張機能のログメッセージを確認

**ログメッセージの例**:

```
[Chat Enter Key Control] フィールドを検出しました: <textarea>
[Chat Enter Key Control] Enterキーを検出: isComposing=true
[Chat Enter Key Control] 改行を挿入しました
```

### Background Scriptのデバッグ

1. `chrome://extensions/` を開く
2. Chat Enter Key Controlの「サービスワーカー」リンクをクリック
3. デベロッパーツールが開きます
4. 「Console」タブでログメッセージを確認

### Content Scriptのデバッグ

1. 対象のページを開く
2. `F12`キーを押してデベロッパーツールを開く
3. 「Console」タブを選択
4. フィルターに「Chat Enter Key Control」と入力

### イベントリスナーの確認

1. `F12`キーを押してデベロッパーツールを開く
2. 「Elements」タブを選択
3. テキストフィールドを選択
4. 右側の「Event Listeners」タブを選択
5. 「keydown」イベントを展開
6. 拡張機能のリスナーが登録されているか確認

## 問題の報告

上記の方法で解決しない場合は、GitHubのIssuesで報告してください。

### 報告に含める情報

1. **環境情報**:
   - ブラウザ: Chrome / Edge / その他
   - バージョン: （例: Chrome 120.0.6099.109）
   - OS: Windows / macOS / Linux

2. **問題の詳細**:
   - 症状: 何が起こるか、何が期待されるか
   - 対象サイト: URL
   - 再現手順: 問題を再現する手順

3. **デバッグ情報**:
   - ブラウザコンソールのエラーメッセージ
   - 拡張機能のログメッセージ
   - スクリーンショット（可能であれば）

4. **試した解決方法**:
   - このガイドで試した方法
   - 結果

### Issueテンプレート

```markdown
## 環境

- ブラウザ: Chrome 120.0.6099.109
- OS: macOS 14.0

## 問題の詳細

### 症状

（何が起こるか説明してください）

### 期待される動作

（何が起こるべきか説明してください）

### 対象サイト

- URL: https://example.com/
- URLパターン: *://example.com/*

### 再現手順

1. （手順1）
2. （手順2）
3. （手順3）

## デバッグ情報

### ブラウザコンソールのエラー

```
（エラーメッセージをここに貼り付けてください）
```

### スクリーンショット

（可能であれば添付してください）

## 試した解決方法

- [ ] URLパターンを確認
- [ ] ページをリロード
- [ ] 拡張機能を再インストール
- [ ] 他の拡張機能を無効化
- [ ] （その他）

## 追加情報

（その他の関連情報があれば記載してください）
```

## よくある質問（FAQ）

### Q: 拡張機能は無料ですか？

A: はい、完全に無料でオープンソースです。

### Q: プライバシーは保護されますか？

A: はい。拡張機能は以下のことを行いません：
- 入力内容の収集
- 外部サーバーへのデータ送信
- トラッキング

すべてのデータはローカルに保存されます。

### Q: 他のブラウザでも使えますか？

A: Chrome拡張機能として開発されていますが、Chromiumベースのブラウザ（Edge、Brave、Operaなど）でも動作する可能性があります。

### Q: モバイルでも使えますか？

A: いいえ。Chrome拡張機能はデスクトップ版のChromeでのみ動作します。

### Q: 設定を複数のデバイスで同期できますか？

A: はい。Chrome Syncを有効にすると、設定が自動的に同期されます。

### Q: 特定のサイトだけで無効化できますか？

A: はい。ポップアップでURLパターンのトグルスイッチをOFFにすることで、特定のサイトで無効化できます。

### Q: カスタムキーバインディングは設定できますか？

A: 現在のバージョンでは、Ctrl+Enter、Alt+Enter、Cmd+Enter、Opt+Enterのみサポートしています。カスタムキーバインディングは将来のバージョンで検討中です。
