# 統合テストガイド

このガイドでは、Chat Enter Key Control拡張機能の実際のチャットアプリケーションでの動作確認方法を説明します。

## テスト前の準備

1. Chrome拡張機能をインストール
   - `chrome://extensions/`を開く
   - デベロッパーモードを有効化
   - 「パッケージ化されていない拡張機能を読み込む」をクリック
   - プロジェクトディレクトリを選択

2. 拡張機能のアイコンがツールバーに表示されることを確認

## テスト対象サイト

以下のサイトでテストを実施してください：

- **ChatGPT**: https://chat.openai.com/
- **Slack**: https://slack.com/
- **Discord**: https://discord.com/
- **その他**: お使いのチャットアプリケーション

## テストケース

### 1. 基本的なEnterキー動作

#### 1.1 通常のEnter（IME入力なし）

**手順:**
1. テキスト入力フィールドにフォーカス
2. 英語で「Hello」と入力
3. Enterキーを押す

**期待結果:**
- 改行が挿入される
- メッセージは送信されない

#### 1.2 修飾キー + Enter（送信）

**手順:**
1. テキスト入力フィールドに「Test message」と入力
2. 以下のいずれかを試す：
   - Ctrl + Enter（Windows/Linux）
   - Cmd + Enter（macOS）
   - Alt + Enter（Windows/Linux）
   - Opt + Enter（macOS）

**期待結果:**
- メッセージが送信される

### 2. 日本語入力（IME）のテスト

#### 2.1 漢字変換確定でのEnter

**手順:**
1. テキスト入力フィールドにフォーカス
2. 日本語入力モードに切り替え
3. 「こんにちは」と入力（変換前の状態）
4. Enterキーを押して変換を確定
5. もう一度Enterキーを押す

**期待結果:**
- 1回目のEnter: 「こんにちは」に変換される（送信されない）
- 2回目のEnter: 改行が挿入される（送信されない）

#### 2.2 複数回の変換

**手順:**
1. 「きょうはいいてんきですね」と入力
2. Enterキーで変換候補を選択（複数回）
3. 最終的にEnterで確定

**期待結果:**
- 各Enterキーで変換が進む
- 確定後も送信されない
- 改行が挿入される

#### 2.3 IME入力中の修飾キー + Enter

**手順:**
1. 日本語入力モードで「てすと」と入力（変換前）
2. Ctrl + Enter（またはCmd + Enter）を押す

**期待結果:**
- IME入力が確定される
- メッセージが送信される

### 3. 複数タブでのテスト

#### 3.1 タブ間の独立性

**手順:**
1. ChatGPTのタブを開く
2. Slackのタブを開く
3. ChatGPTのタブで日本語入力を開始
4. Slackのタブに切り替え
5. Slackのタブで日本語入力を開始

**期待結果:**
- 各タブで独立してIME状態が管理される
- 一方のタブの操作が他方に影響しない

#### 3.2 同じサイトの複数タブ

**手順:**
1. ChatGPTのタブを2つ開く
2. 両方のタブで日本語入力をテスト

**期待結果:**
- 各タブで独立して動作する

### 4. 動的フィールドの検出

#### 4.1 後から追加されるフィールド

**手順:**
1. チャットアプリケーションを開く
2. 新しいチャンネルやチャットルームを作成
3. 新しく表示されたテキスト入力フィールドで日本語入力をテスト

**期待結果:**
- 動的に追加されたフィールドでも正しく動作する

### 5. 送信ボタンとの互換性

#### 5.1 マウスクリックでの送信

**手順:**
1. テキスト入力フィールドにメッセージを入力
2. 送信ボタンをマウスでクリック

**期待結果:**
- メッセージが正常に送信される
- 拡張機能が送信を妨げない

### 6. 特殊なフィールドタイプ

#### 6.1 contenteditable要素

**手順:**
1. contenteditableを使用しているサイト（例：一部のリッチテキストエディタ）でテスト
2. 日本語入力とEnterキーの動作を確認

**期待結果:**
- textarea/inputと同様に動作する

### 7. URLパターン管理

#### 7.1 拡張機能の有効化/無効化

**手順:**
1. 拡張機能のアイコンをクリック
2. ポップアップで現在のドメインをトグル
3. ページをリロード
4. Enterキーの動作を確認

**期待結果:**
- 無効化した場合: 元のサイトの動作に戻る
- 有効化した場合: 拡張機能が動作する

#### 7.2 カスタムURLパターンの追加

**手順:**
1. ポップアップでカスタムURLパターンを追加
2. そのパターンにマッチするページを開く
3. 動作を確認

**期待結果:**
- 追加したパターンにマッチするページで拡張機能が動作する

## トラブルシューティング

### 問題: 拡張機能が動作しない

**確認事項:**
1. 拡張機能が有効になっているか（`chrome://extensions/`で確認）
2. 現在のサイトがURLパターンにマッチしているか
3. ページをリロードしたか
4. コンソールにエラーが出ていないか（F12で開発者ツールを開く）

### 問題: 日本語入力が正しく動作しない

**確認事項:**
1. IMEが正しく有効になっているか
2. ブラウザのバージョンが最新か
3. 他の拡張機能との競合がないか

### 問題: 送信ボタンが動作しない

**確認事項:**
1. サイト固有の問題の可能性
2. コンソールでエラーを確認
3. 拡張機能を一時的に無効化して比較

## テスト結果の記録

以下のチェックリストを使用してテスト結果を記録してください：

- [ ] ChatGPTで基本動作確認
- [ ] ChatGPTで日本語入力確認
- [ ] Slackで基本動作確認
- [ ] Slackで日本語入力確認
- [ ] Discordで基本動作確認
- [ ] Discordで日本語入力確認
- [ ] 複数タブでの独立性確認
- [ ] 動的フィールドの検出確認
- [ ] 送信ボタンの互換性確認
- [ ] URLパターン管理の動作確認

## 既知の制約

以下の環境では拡張機能が動作しません（技術的制約）：

- 他のChrome拡張機能のサイドパネル内
- 他のChrome拡張機能のポップアップ内
- `chrome://`スキームのページ
- `chrome-extension://`スキームのページ

詳細は`README.md`の「技術的制約」セクションを参照してください。

## フィードバック

テスト中に問題を発見した場合は、以下の情報を記録してください：

1. **発生したサイト**: URL
2. **再現手順**: 詳細な手順
3. **期待される動作**: 何が起こるべきか
4. **実際の動作**: 何が起こったか
5. **コンソールエラー**: あれば記録
6. **ブラウザバージョン**: Chrome のバージョン
7. **OS**: Windows/macOS/Linux

この情報をGitHub Issuesに報告するか、開発者に共有してください。
